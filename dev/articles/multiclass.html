<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multiclass averaging • yardstick</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multiclass averaging">
<meta name="robots" content="noindex">
<script defer data-domain="yardstick.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">yardstick</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/grouping.html">Grouping behavior in yardstick</a></li>
    <li><a class="dropdown-item" href="../articles/metric-types.html">Metric types</a></li>
    <li><a class="dropdown-item" href="../articles/multiclass.html">Multiclass averaging</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn more</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-more">
<li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/develop/metrics/">Custom performance metrics</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/yardstick/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Multiclass averaging</h1>
                        <h4 data-toc-skip class="author">Davis
Vaughan</h4>
            
            <h4 data-toc-skip class="date">2025-01-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/yardstick/blob/main/vignettes/multiclass.Rmd" class="external-link"><code>vignettes/multiclass.Rmd</code></a></small>
      <div class="d-none name"><code>multiclass.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Classification metrics in <code>yardstick</code> where both the
<code>truth</code> and <code>estimate</code> columns are factors are
implemented for the binary and the multiclass case. The multiclass
implementations use <code>micro</code>, <code>macro</code>, and
<code>macro_weighted</code> averaging where applicable, and some metrics
have their own specialized multiclass implementations.</p>
</div>
<div class="section level2">
<h2 id="macro-averaging">Macro averaging<a class="anchor" aria-label="anchor" href="#macro-averaging"></a>
</h2>
<p>Macro averaging reduces your multiclass predictions down to multiple
sets of binary predictions, calculates the corresponding metric for each
of the binary cases, and then averages the results together. As an
example, consider <code>precision</code> for the binary case.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
Pr = \frac{TP}{TP + FP} 
</annotation></semantics></math></p>
<p>In the multiclass case, if there were levels <code>A</code>,
<code>B</code>, <code>C</code> and <code>D</code>, macro averaging
reduces the problem to multiple one-vs-all comparisons. The
<code>truth</code> and <code>estimate</code> columns are recoded such
that the only two levels are <code>A</code> and <code>other</code>, and
then precision is calculated based on those recoded columns, with
<code>A</code> being the “relevant” column. This process is repeated for
the other 3 levels to get a total of 4 precision values. The results are
then averaged together.</p>
<p>The formula representation looks like this. For <code>k</code>
classes:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>r</mi><mrow><mi>m</mi><mi>a</mi><mi>c</mi><mi>r</mi><mi>o</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>P</mi><msub><mi>r</mi><mn>1</mn></msub><mo>+</mo><mi>P</mi><msub><mi>r</mi><mn>2</mn></msub><mo>+</mo><mi>…</mi><mo>+</mo><mi>P</mi><msub><mi>r</mi><mi>k</mi></msub></mrow><mi>k</mi></mfrac><mo>=</mo><mi>P</mi><msub><mi>r</mi><mn>1</mn></msub><mfrac><mn>1</mn><mi>k</mi></mfrac><mo>+</mo><mi>P</mi><msub><mi>r</mi><mn>2</mn></msub><mfrac><mn>1</mn><mi>k</mi></mfrac><mo>+</mo><mi>…</mi><mo>+</mo><mi>P</mi><msub><mi>r</mi><mi>k</mi></msub><mfrac><mn>1</mn><mi>k</mi></mfrac></mrow><annotation encoding="application/x-tex">
Pr_{macro} = \frac{Pr_1 + Pr_2 + \ldots + Pr_k}{k} = Pr_1 \frac{1}{k} + Pr_2 \frac{1}{k} + \ldots + Pr_k \frac{1}{k}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">PR_1</annotation></semantics></math>
is the precision calculated from recoding the multiclass predictions
down to just <code>class 1</code> and <code>other</code>.</p>
<p>Note that in macro averaging, all classes get equal weight when
contributing their portion of the precision value to the total (here
<code>1/4</code>). This might not be a realistic calculation when you
have a large amount of class imbalance. In that case, a <em>weighted
macro average</em> might make more sense, where the weights are
calculated by the frequency of that class in the <code>truth</code>
column.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>r</mi><mrow><mi>w</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>e</mi><mi>d</mi><mo>−</mo><mi>m</mi><mi>a</mi><mi>c</mi><mi>r</mi><mi>o</mi></mrow></msub><mo>=</mo><mi>P</mi><msub><mi>r</mi><mn>1</mn></msub><mfrac><mrow><mi>#</mi><mi>O</mi><mi>b</mi><msub><mi>s</mi><mn>1</mn></msub></mrow><mi>N</mi></mfrac><mo>+</mo><mi>P</mi><msub><mi>r</mi><mn>2</mn></msub><mfrac><mrow><mi>#</mi><mi>O</mi><mi>b</mi><msub><mi>s</mi><mn>2</mn></msub></mrow><mi>N</mi></mfrac><mo>+</mo><mi>…</mi><mo>+</mo><mi>P</mi><msub><mi>r</mi><mi>k</mi></msub><mfrac><mrow><mi>#</mi><mi>O</mi><mi>b</mi><msub><mi>s</mi><mi>k</mi></msub></mrow><mi>N</mi></mfrac></mrow><annotation encoding="application/x-tex">
Pr_{weighted-macro} = Pr_1 \frac{\#Obs_1}{N} + Pr_2 \frac{\#Obs_2}{N} + \ldots + Pr_k \frac{\#Obs_k}{N}
</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="micro-averaging">Micro averaging<a class="anchor" aria-label="anchor" href="#micro-averaging"></a>
</h2>
<p>Micro averaging treats the entire set of data as an aggregate result,
and calculates 1 metric rather than <code>k</code> metrics that get
averaged together.</p>
<p>For precision, this works by calculating all of the true positive
results for each class and using that as the numerator, and then
calculating all of the true positive and false positive results for each
class, and using that as the denominator.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>r</mi><mrow><mi>m</mi><mi>i</mi><mi>c</mi><mi>r</mi><mi>o</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>T</mi><msub><mi>P</mi><mn>1</mn></msub><mo>+</mo><mi>T</mi><msub><mi>P</mi><mn>2</mn></msub><mo>+</mo><mi>…</mi><mo>+</mo><mi>T</mi><msub><mi>P</mi><mi>k</mi></msub></mrow><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><msub><mi>P</mi><mn>1</mn></msub><mo>+</mo><mi>T</mi><msub><mi>P</mi><mn>2</mn></msub><mo>+</mo><mi>…</mi><mo>+</mo><mi>T</mi><msub><mi>P</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>F</mi><msub><mi>P</mi><mn>1</mn></msub><mo>+</mo><mi>F</mi><msub><mi>P</mi><mn>2</mn></msub><mo>+</mo><mi>…</mi><mo>+</mo><mi>F</mi><msub><mi>P</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
Pr_{micro} = \frac{TP_1 + TP_2 + \ldots + TP_k}{(TP_1 + TP_2 + \ldots + TP_k) + (FP_1 + FP_2 + \ldots + FP_k)}
</annotation></semantics></math> In this case, rather than each
<em>class</em> having equal weight, each <em>observation</em> gets equal
weight. This gives the classes with the most observations more
power.</p>
</div>
<div class="section level2">
<h2 id="specialized-multiclass-implementations">Specialized multiclass implementations<a class="anchor" aria-label="anchor" href="#specialized-multiclass-implementations"></a>
</h2>
<p>Some metrics have known analytical multiclass extensions, and do not
need to use averaging to get an estimate of multiclass performance.</p>
<p>Accuracy and Kappa use the same definitions as their binary
counterpart, with accuracy counting up the number of correctly predicted
true values out of the total number of true values, and kappa being a
linear combination of two accuracy values.</p>
<p>Matthews correlation coefficient (MCC) has a known multiclass
generalization as well, sometimes called the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>K</mi></msub><annotation encoding="application/x-tex">R_K</annotation></semantics></math>
statistic. Refer to <a href="https://en.wikipedia.org/wiki/Matthews_correlation_coefficient#Multiclass_case" class="external-link">this
page</a> for more details.</p>
<p>ROC AUC is an interesting metric in that it intuitively makes sense
to perform macro averaging, which computes a multiclass AUC as the
average of the area under multiple binary ROC curves. However, this
loses an important property of the ROC AUC statistic in that its binary
case is insensitive to class distribution. To combat this, a multiclass
metric was created that retains insensitivity to class distribution, but
does not have an easy visual interpretation like macro averaging. This
is implemented as the <code>"hand_till"</code> method, and is the
default for this metric.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, Emil Hvitfeldt, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
