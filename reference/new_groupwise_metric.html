<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Groupwise metrics quantify the disparity in value of a metric across a
number of groups. Groupwise metrics with a value of zero indicate that the
underlying metric is equal across groups. yardstick defines
several common fairness metrics using this function, such as
demographic_parity(), equal_opportunity(), and equalized_odds()."><title>Create groupwise metrics — new_groupwise_metric • yardstick</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.8/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.8/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create groupwise metrics — new_groupwise_metric"><meta property="og:description" content="Groupwise metrics quantify the disparity in value of a metric across a
number of groups. Groupwise metrics with a value of zero indicate that the
underlying metric is equal across groups. yardstick defines
several common fairness metrics using this function, such as
demographic_parity(), equal_opportunity(), and equalized_odds()."><meta property="og:image" content="https://yardstick.tidymodels.org/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="yardstick.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">yardstick</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/grouping.html">Grouping behavior in yardstick</a>
    <a class="dropdown-item" href="../articles/metric-types.html">Metric types</a>
    <a class="dropdown-item" href="../articles/multiclass.html">Multiclass averaging</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-learn-more">Learn more</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-learn-more">
    <a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/develop/metrics/">Custom performance metrics</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidymodels/yardstick/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create groupwise metrics</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/yardstick/blob/HEAD/R/fair-aaa.R" class="external-link"><code>R/fair-aaa.R</code></a></small>
      <div class="d-none name"><code>new_groupwise_metric.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Groupwise metrics quantify the disparity in value of a metric across a
number of groups. Groupwise metrics with a value of zero indicate that the
underlying metric is equal across groups. yardstick defines
several common fairness metrics using this function, such as
<code><a href="demographic_parity.html">demographic_parity()</a></code>, <code><a href="equal_opportunity.html">equal_opportunity()</a></code>, and <code><a href="equalized_odds.html">equalized_odds()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">new_groupwise_metric</span><span class="op">(</span><span class="va">fn</span>, <span class="va">name</span>, <span class="va">aggregate</span>, direction <span class="op">=</span> <span class="st">"minimize"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fn</dt>
<dd><p>A yardstick metric function or metric set.</p></dd>


<dt>name</dt>
<dd><p>The name of the metric to place in the <code>.metric</code> column
of the output.</p></dd>


<dt>aggregate</dt>
<dd><p>A function to summarize the generated metric set results.
The function takes metric set results as the first argument and returns
a single numeric giving the <code>.estimate</code> value as output. See the Value and
Examples sections for example uses.</p></dd>


<dt>direction</dt>
<dd><p>A string. One of:</p><ul><li><p><code>"maximize"</code></p></li>
<li><p><code>"minimize"</code></p></li>
<li><p><code>"zero"</code></p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>This function is a
<a href="https://adv-r.hadley.nz/function-factories.html" class="external-link">function factory</a>; it's
output is itself a function. Further, the functions that this function
outputs are also function factories. More explicitly, this looks like:</p>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a function with similar implementation to `demographic_parity()`:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>diff_range <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">diff</span>(<span class="fu">range</span>(x<span class="sc">$</span>.estimate))}</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>dem_parity <span class="ot">&lt;-</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_groupwise_metric</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fn =</span> detection_prevalence,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"dem_parity"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">aggregate =</span> diff_range</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre><p></p></div>



<p>The outputted <code>dem_parity</code> is a function that takes one argument, <code>by</code>,
indicating the data-masked variable giving the sensitive feature.</p>


<p>When called with a <code>by</code> argument, <code>dem_parity</code> will return a yardstick
metric function like any other:</p>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dem_parity_by_gender <span class="ot">&lt;-</span> <span class="fu">dem_parity</span>(gender)</span></code></pre><p></p></div>



<p>Note that <code>dem_parity</code> doesn't take any arguments other than <code>by</code>, and thus
knows nothing about the data it will be applied to other than that it ought
to have a column with name <code>"gender"</code> in it.</p>


<p>The output <code>dem_parity_by_gender</code> is a metric function that takes the
same arguments as the function supplied as <code>fn</code>, in this case
<code>detection_prevalence</code>. It will thus interface like any other yardstick
function except that it will look for a <code>"gender"</code> column in
the data it's supplied.</p>


<p>In addition to the examples below, see the documentation on the
return value of fairness metrics like <code><a href="demographic_parity.html">demographic_parity()</a></code>,
<code><a href="equal_opportunity.html">equal_opportunity()</a></code>, or <code><a href="equalized_odds.html">equalized_odds()</a></code> to learn more about how the
output of this function can be used.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that <em>all</em> yardstick metrics are group-aware in that, when passed
grouped data, they will return metric values calculated for each group.
When passed grouped data, groupwise metrics also return metric values
for each group, but those metric values are calculated by first additionally
grouping by the variable passed to <code>by</code> and then summarizing the per-group
metric estimates across groups using the function passed as the
<code>aggregate</code> argument. Learn more about grouping behavior in yardstick using
<code><a href="../articles/grouping.html">vignette("grouping", "yardstick")</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="relevant-group-level">Relevant Group Level<a class="anchor" aria-label="anchor" href="#relevant-group-level"></a></h2>
    

<p>Additional arguments can be passed to the function outputted by
the function that this function outputs. That is:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>res_fairness <span class="ot">&lt;-</span> <span class="fu">new_groupwise_metric</span>(...)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>res_by <span class="ot">&lt;-</span> <span class="fu">res_fairness</span>(by)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">res_by</span>(..., <span class="at">additional_arguments_to_aggregate =</span> <span class="cn">TRUE</span>)</span></code></pre><p></p></div>
<p>For finer control of how groups in <code>by</code> are treated, use the
<code>aggregate</code> argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">hpc_cv</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `demographic_parity`, among other fairness metrics,</span></span></span>
<span class="r-in"><span><span class="co"># is generated with `new_groupwise_metric()`:</span></span></span>
<span class="r-in"><span><span class="va">diff_range</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">.estimate</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">demographic_parity_</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">new_groupwise_metric</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fn <span class="op">=</span> <span class="va">detection_prevalence</span>,</span></span>
<span class="r-in"><span>    name <span class="op">=</span> <span class="st">"demographic_parity"</span>,</span></span>
<span class="r-in"><span>    aggregate <span class="op">=</span> <span class="va">diff_range</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="metric_set.html">metric_set</a></span><span class="op">(</span><span class="fu">demographic_parity_</span><span class="op">(</span><span class="va">Resample</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">m_set</span><span class="op">(</span><span class="va">hpc_cv</span>, truth <span class="op">=</span> <span class="va">obs</span>, estimate <span class="op">=</span> <span class="va">pred</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .metric            .by      .estimator .estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> demographic_parity Resample macro       2.78<span style="color: #949494;">e</span><span style="color: #BB0000;">-17</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the `post` argument can be used to accommodate a wide</span></span></span>
<span class="r-in"><span><span class="co"># variety of parameterizations. to encode demographic</span></span></span>
<span class="r-in"><span><span class="co"># parity as a ratio inside of a difference, for example:</span></span></span>
<span class="r-in"><span><span class="va">ratio_range</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">.estimate</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">demographic_parity_ratio</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">new_groupwise_metric</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fn <span class="op">=</span> <span class="va">detection_prevalence</span>,</span></span>
<span class="r-in"><span>    name <span class="op">=</span> <span class="st">"demographic_parity_ratio"</span>,</span></span>
<span class="r-in"><span>    aggregate <span class="op">=</span> <span class="va">ratio_range</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, Emil Hvitfeldt, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

